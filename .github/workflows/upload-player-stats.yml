name: Upload Player Stats

on:
  schedule:
    # Run every Tuesday at noon US Central Time (18:00 UTC)
    # Note: During daylight saving time (CDT), this runs at 1 PM CDT
    # During standard time (CST), this runs at 12 PM CST
    - cron: '0 18 * * 2'
  workflow_dispatch:  # Allow manual triggering from GitHub Actions UI

jobs:
  upload-stats:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r backend/requirements.txt
      
      # Upload player stats to Supabase
      # Format: {TEAM_NAME}_EXPORT_URL (e.g., AUBURN_EXPORT_URL)
      - name: Upload player stats to Supabase
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          AUBURN_EXPORT_URL: ${{ secrets.AUBURN_EXPORT_URL }}
          ALABAMA_EXPORT_URL: ${{ secrets.ALABAMA_EXPORT_URL }}
          MSU_EXPORT_URL: ${{ secrets.MSU_EXPORT_URL }}
        run: |
          python backend/scripts/upload_player_stats.py

